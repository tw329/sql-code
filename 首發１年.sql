with 
a2011 as
(select distinct(A.ID) from (
	SELECT ID FROM HIGH_AGE_CD.DBO.CD2011
	WHERE 
		(SUBSTRING(ACODE_ICD9_1,1,3) = '250' AND SUBSTRING(ACODE_ICD9_1,5,1) != '3' AND SUBSTRING(ACODE_ICD9_1,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_2,1,3) = '250' AND SUBSTRING(ACODE_ICD9_2,5,1) != '3' AND SUBSTRING(ACODE_ICD9_2,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_3,1,3) = '250' AND SUBSTRING(ACODE_ICD9_3,5,1) != '3' AND SUBSTRING(ACODE_ICD9_3,5,1) != '1')
	union all
	SELECT ID FROM HIGH_AGE_DD.DBO.DD2011
	WHERE 
		(SUBSTRING(ICD9CM_CODE,1,3) = '250' AND SUBSTRING(ICD9CM_CODE,5,1) != '3' AND SUBSTRING(ICD9CM_CODE,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_1,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_2,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_3,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_4,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '1'))
	as A
),
b2012 as(
	SELECT ID FROM HIGH_AGE_CD.DBO.CD2012
	WHERE 
		((SUBSTRING(ACODE_ICD9_1,1,3) = '250' AND SUBSTRING(ACODE_ICD9_1,5,1) != '3' AND SUBSTRING(ACODE_ICD9_1,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_2,1,3) = '250' AND SUBSTRING(ACODE_ICD9_2,5,1) != '3' AND SUBSTRING(ACODE_ICD9_2,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_3,1,3) = '250' AND SUBSTRING(ACODE_ICD9_3,5,1) != '3' AND SUBSTRING(ACODE_ICD9_3,5,1) != '1'))
		AND
		ID not in (select distinct(id) from a2011)
	union all
	SELECT ID FROM HIGH_AGE_DD.DBO.DD2012
	WHERE 
		((SUBSTRING(ICD9CM_CODE,1,3) = '250' AND SUBSTRING(ICD9CM_CODE,5,1) != '3' AND SUBSTRING(ICD9CM_CODE,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_1,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_2,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_3,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_4,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '1'))
		AND
		ID not in (select distinct(id) from a2011)
)
select distinct(b2012.ID), HIGH_AGE_ID.dbo.NEW_ID100W.ID_SEX, HIGH_AGE_ID.dbo.NEW_ID100W.NEW_BIRTHDAY from b2012
left join HIGH_AGE_ID.dbo.NEW_ID100W
on b2012.ID = HIGH_AGE_ID.dbo.NEW_ID100W.ID