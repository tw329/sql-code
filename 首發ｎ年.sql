with
a2011 as(
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_CD.DBO.CD2011
	WHERE 
		(SUBSTRING(ACODE_ICD9_1,1,3) = '250' AND SUBSTRING(ACODE_ICD9_1,5,1) != '3' AND SUBSTRING(ACODE_ICD9_1,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_2,1,3) = '250' AND SUBSTRING(ACODE_ICD9_2,5,1) != '3' AND SUBSTRING(ACODE_ICD9_2,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_3,1,3) = '250' AND SUBSTRING(ACODE_ICD9_3,5,1) != '3' AND SUBSTRING(ACODE_ICD9_3,5,1) != '1')
	union all
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_DD.DBO.DD2011
	WHERE 
		(SUBSTRING(ICD9CM_CODE,1,3) = '250' AND SUBSTRING(ICD9CM_CODE,5,1) != '3' AND SUBSTRING(ICD9CM_CODE,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_1,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_2,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_3,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_4,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '1')

), 
a2010 as(
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_CD.DBO.CD2010
	WHERE 
		(SUBSTRING(ACODE_ICD9_1,1,3) = '250' AND SUBSTRING(ACODE_ICD9_1,5,1) != '3' AND SUBSTRING(ACODE_ICD9_1,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_2,1,3) = '250' AND SUBSTRING(ACODE_ICD9_2,5,1) != '3' AND SUBSTRING(ACODE_ICD9_2,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_3,1,3) = '250' AND SUBSTRING(ACODE_ICD9_3,5,1) != '3' AND SUBSTRING(ACODE_ICD9_3,5,1) != '1')
	union all
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_DD.DBO.DD2010
	WHERE 
		(SUBSTRING(ICD9CM_CODE,1,3) = '250' AND SUBSTRING(ICD9CM_CODE,5,1) != '3' AND SUBSTRING(ICD9CM_CODE,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_1,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_2,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_3,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_4,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '1')
), 
a2009 as(
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_CD.DBO.CD2009
	WHERE 
		(SUBSTRING(ACODE_ICD9_1,1,3) = '250' AND SUBSTRING(ACODE_ICD9_1,5,1) != '3' AND SUBSTRING(ACODE_ICD9_1,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_2,1,3) = '250' AND SUBSTRING(ACODE_ICD9_2,5,1) != '3' AND SUBSTRING(ACODE_ICD9_2,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_3,1,3) = '250' AND SUBSTRING(ACODE_ICD9_3,5,1) != '3' AND SUBSTRING(ACODE_ICD9_3,5,1) != '1')
	union all
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_DD.DBO.DD2009
	WHERE 
		(SUBSTRING(ICD9CM_CODE,1,3) = '250' AND SUBSTRING(ICD9CM_CODE,5,1) != '3' AND SUBSTRING(ICD9CM_CODE,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_1,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_2,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_3,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_4,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '1')
),
a2008 as(
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_CD.DBO.CD2008
	WHERE 
		(SUBSTRING(ACODE_ICD9_1,1,3) = '250' AND SUBSTRING(ACODE_ICD9_1,5,1) != '3' AND SUBSTRING(ACODE_ICD9_1,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_2,1,3) = '250' AND SUBSTRING(ACODE_ICD9_2,5,1) != '3' AND SUBSTRING(ACODE_ICD9_2,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_3,1,3) = '250' AND SUBSTRING(ACODE_ICD9_3,5,1) != '3' AND SUBSTRING(ACODE_ICD9_3,5,1) != '1')
	union all
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_DD.DBO.DD2008
	WHERE 
		(SUBSTRING(ICD9CM_CODE,1,3) = '250' AND SUBSTRING(ICD9CM_CODE,5,1) != '3' AND SUBSTRING(ICD9CM_CODE,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_1,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_2,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_3,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_4,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '1')
),
a2007 as(
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_CD.DBO.CD2007
	WHERE 
		(SUBSTRING(ACODE_ICD9_1,1,3) = '250' AND SUBSTRING(ACODE_ICD9_1,5,1) != '3' AND SUBSTRING(ACODE_ICD9_1,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_2,1,3) = '250' AND SUBSTRING(ACODE_ICD9_2,5,1) != '3' AND SUBSTRING(ACODE_ICD9_2,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_3,1,3) = '250' AND SUBSTRING(ACODE_ICD9_3,5,1) != '3' AND SUBSTRING(ACODE_ICD9_3,5,1) != '1')
	union all
	SELECT ID ,'1' as diabetes FROM HIGH_AGE_DD.DBO.DD2007
	WHERE 
		(SUBSTRING(ICD9CM_CODE,1,3) = '250' AND SUBSTRING(ICD9CM_CODE,5,1) != '3' AND SUBSTRING(ICD9CM_CODE,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_1,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_2,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_3,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_4,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '1')
),
a2012 as(
	SELECT ID FROM HIGH_AGE_CD.DBO.CD2012
	WHERE 
		(SUBSTRING(ACODE_ICD9_1,1,3) = '250' AND SUBSTRING(ACODE_ICD9_1,5,1) != '3' AND SUBSTRING(ACODE_ICD9_1,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_2,1,3) = '250' AND SUBSTRING(ACODE_ICD9_2,5,1) != '3' AND SUBSTRING(ACODE_ICD9_2,5,1) != '1')
		OR
		(SUBSTRING(ACODE_ICD9_3,1,3) = '250' AND SUBSTRING(ACODE_ICD9_3,5,1) != '3' AND SUBSTRING(ACODE_ICD9_3,5,1) != '1')
	union all
	SELECT ID FROM HIGH_AGE_DD.DBO.DD2012
	WHERE 
		(SUBSTRING(ICD9CM_CODE,1,3) = '250' AND SUBSTRING(ICD9CM_CODE,5,1) != '3' AND SUBSTRING(ICD9CM_CODE,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_1,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_1,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_2,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_2,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_3,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_3,5,1) != '1')
		OR
		(SUBSTRING(ICD9CM_CODE_4,1,3) = '250' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '3' AND SUBSTRING(ICD9CM_CODE_4,5,1) != '1')
),
total as(
		select * from a2007
		union all
		select * from a2008
		union all
		select * from a2009
		union all
		select * from a2010
		union all
		select * from a2011
),
final as(
select a2012.ID, total.diabetes from a2012
left join total
on a2012.ID = total.id
where total.diabetes is NULL
)
select distinct(final.ID), HIGH_AGE_ID.dbo.NEW_ID100W.ID_SEX, HIGH_AGE_ID.dbo.NEW_ID100W.NEW_BIRTHDAY from final
left join HIGH_AGE_ID.dbo.NEW_ID100W
on final.ID = HIGH_AGE_ID.dbo.NEW_ID100W.ID